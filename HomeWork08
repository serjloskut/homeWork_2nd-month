using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.IO;

namespace HomeWork1
{
    class Program
    {
        static void Main(string[] args)
        {
            User buyer = new User();
            Seller seller = new Seller();
            bool isContinue = true;

            while (isContinue)
            {
                Console.WriteLine("Выберите действие:\n1. Купить что-то.\n2. Посмотреть свою корзину.\n3. Выход из программы");

                Console.SetCursorPosition(0,15);
                seller.PrintBasket();
                Console.SetCursorPosition(0, 4);

                switch (Convert.ToInt32(Console.ReadLine()))
                {
                    case 1:
                        buyer.AddProduct(seller);
                        break;
                    case 2:
                        buyer.PrintBasket();
                        break;
                    case 3:
                        isContinue=false;
                        break;
                    default:
                        Console.WriteLine("Неверная команда. Попробуйте еще раз");
                        break;
                }
            }

            Console.ReadKey();
        }

        static void Print(List<Product> basket)
        {
            foreach (var product in basket)
            {
                Console.WriteLine($"1. {product.Name} - {product.Quantity} шт.");
            }
        }

        class Seller
        {
            List<Product> _basket = new List<Product>();

            public Seller()
            {
                AddProduct();
            }

            public void PrintBasket()
            {
                Console.WriteLine("В магазине в наличии следующие продукты:");
                Print(_basket);
                Console.WriteLine();
            }

            public bool IsProduct(string name, int quantity)
            {
                bool isProduct=false;
                string nameProduct = name;
                int quantityProduct = quantity;

                foreach (var product in _basket)
                {
                    if (product.Name == nameProduct && product.Quantity >= quantityProduct)
                        isProduct = true;
                }

                return isProduct;
            }

            public void SellProduct(string name, int quantity)
            {
                string nameProduct = name;
                int quantityProduct = quantity;

                foreach (var product in _basket)
                {
                    if (product.Name == nameProduct)
                        product.Sell(quantityProduct);
                }
            }

            private void AddProduct()
            {
                _basket.Add(new Product("Огурцы", 7));
                _basket.Add(new Product("Капуста", 20));
                _basket.Add(new Product("Пельмени", 14));
                _basket.Add(new Product("Колбаса", 3));
            }
        }

        class User
        {
            List<Product> _basket = new List<Product>();

            public void AddProduct(Seller seller)
            {
                string name;
                int quantity;

                Console.Write("Введите название продукта: ");
                name = Console.ReadLine();
                Console.Write("Введите количество продукта: ");
                quantity = Convert.ToInt32(Console.ReadLine());

                if (seller.IsProduct(name, quantity))
                {
                    _basket.Add(new Product(name, quantity));
                    seller.SellProduct(name,quantity);
                }
                else
                    Console.WriteLine("Ошибка покупки: недостаточно продукта у продавца");

                Console.Clear();
            }

            public void PrintBasket()
            {
                Console.Clear();
                Console.WriteLine("В вашей корзине находятся следующие продукты:");
                Print(_basket);
                Console.WriteLine();
            }
        }

        class Product
        {
            public string Name { get; private set; }
            public int Quantity { get; private set; }
            public Product(string name, int quantity )
            {
                Name = name;
                Quantity = quantity;
            }

            public void Sell(int quantity)
            {
                Quantity -= quantity;
            }
        }
    }
}
