using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.IO;

namespace HomeWork1
{
    class Program
    {
        static void Main(string[] args)
        {
            People buyer = new People();
            People seller = new People();
            Product cucumber = new Product("Огурец");
            Product banana = new Product("Банан");
            Product cheese = new Product("Сыр");
            Product chupaChups = new Product("Чупа-чупс");
            bool isContinue = true;

            AddProductSeller(seller, cucumber, banana, cheese, chupaChups);

            while (isContinue)
            {
                Console.SetCursorPosition(0, 15);
                Console.WriteLine("Товары в наличии:");
                seller.Show();

                Console.SetCursorPosition(0, 0);
                Console.WriteLine("Доступные действие:\n" +
                    "1. Купить товар.\n" +
                    "2. Показать свою корзину.\n" +
                    "3. Выйти из магазина.\n");
                Console.Write("Введите номер действия: ");

                switch (Console.ReadLine())
                {
                    case "1":
                        Console.Write("Введите название продукта: ");
                        string userNameProduct = Console.ReadLine();

                        if (!seller.IsProduct(seller.GetProduct(userNameProduct)))
                            break;

                        Console.Write("Введите количество продукта: ");
                        int userCountProduct = Convert.ToInt32(Console.ReadLine());

                        if (!seller.IsQuantityProduct(seller.GetProduct(userNameProduct), userCountProduct))
                            break;

                        buyer.BuyProduct(seller.GetProduct(userNameProduct), userCountProduct);
                        seller.SellProduct(seller.GetProduct(userNameProduct), userCountProduct);

                        Console.Write("Покупка успешно завершена. Нажмите любую клавишу для продолжения...");
                        Console.ReadKey();
                        break;
                    case "2":
                        buyer.Show();

                        Console.Write("Нажмите любую клавишу для продолжения: ");
                        Console.ReadKey();
                        break;
                    case "3":
                        isContinue = false;
                        break;
                    default:
                        Console.Write("Команда не распознана. Нажмите любую клавишу для повторного выбора...");
                        Console.ReadKey();
                        break;
                }
                Console.Clear();
            }
        }

        static void AddProductSeller(People people, Product product1, Product product2, Product product3, Product product4)
        {
            people.BuyProduct(product1, 15);
            people.BuyProduct(product2, 7);
            people.BuyProduct(product3, 5);
            people.BuyProduct(product4, 10);
        }
    }

    class Product
    {
        public string Name { get; private set; }

        public Product(string name)
        {
            Name = name;
        }
    }

    class People
    {
        private Dictionary<Product, int> _basket = new Dictionary<Product, int>();

        public Product GetProduct(string nameProduct)
        {
            foreach (var product in _basket)
            {
                if (product.Key.Name == nameProduct)
                {
                    return product.Key;
                }
            }

            return new Product("");
        }

        public void BuyProduct(Product product, int quantity)
        {
            if (_basket.ContainsKey(product))
                _basket[product] += quantity;
            else
                _basket.Add(product, quantity);
        }

        public void SellProduct(Product product, int quantitySell)
        {
            _basket[product] -= quantitySell;

            if (_basket[product] == 0)
                _basket.Remove(product);
        }

        public void Show()
        {
            foreach (var product in _basket)
            {
                Console.WriteLine($"{product.Key.Name} - {product.Value} шт.");
            }
        }

        public bool IsProduct(Product product)
        {
            if (!_basket.ContainsKey(product))
            {
                Console.WriteLine("Этого продукта нет в наличии! Нажмите лубую клавишу для продолжения...");
                Console.ReadKey();
            }
                
            return _basket.ContainsKey(product);
        }

        public bool IsQuantityProduct(Product product, int quantity)
        {
            if (!(_basket[product] >= quantity))
            {
                Console.WriteLine("Такого количества продукта нет в наличии! Нажмите лубую клавишу для продолжения...");
                Console.ReadKey();
            }
                
            return _basket[product] >= quantity;
        }
    }
}
